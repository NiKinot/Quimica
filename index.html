<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Equilibrio Qu√≠mico y Le Chatelier</title>
  <style>
    body {
      background: #f4f8fa;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #2a3d66;
      text-align: center;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 900px;
      margin: auto;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input, select, button, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 1em;
    }
    button {
      background: #2a3d66;
      color: white;
      margin-top: 20px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #1c2747;
    }
    .result {
      background: #eef4ff;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      white-space: pre-wrap;
      font-family: monospace;
    }
  </style>
</head>
<body>

  <h1>Equilibrio Qu√≠mico y Le Chatelier</h1>

  <div class="card">
    <label for="equation">Ecuaci√≥n qu√≠mica (con ‚áå si hay equilibrio):</label>
    <input type="text" id="equation" placeholder="Ej: N2 + 3H2 ‚áå 2NH3" value="N2 + 3H2 ‚áå 2NH3">

    <label for="concentrations">Concentraciones iniciales (en mol/L, separadas por comas en orden seg√∫n especies):</label>
    <input type="text" id="concentrations" placeholder="Ej: 1.0, 3.0, 0" value="1.0, 3.0, 0">

    <label for="reactionType">Tipo de reacci√≥n t√©rmica:</label>
    <select id="reactionType">
      <option value="">Selecciona tipo</option>
      <option value="endotermica">Endot√©rmica</option>
      <option value="exotermica">Exot√©rmica</option>
      <option value="desconocido" selected>Desconocido / No especificado</option>
    </select>

    <label for="change">Aplicar cambio seg√∫n Le Chatelier:</label>
    <select id="change">
      <option value="">Selecciona una perturbaci√≥n</option>
      <option value="presion">‚Üë Presi√≥n</option>
      <option value="concentracionReactivos">‚Üë Reactivos</option>
      <option value="concentracionProductos">‚Üë Productos</option>
      <option value="temperaturaAlta">‚Üë Temperatura</option>
      <option value="temperaturaBaja">‚Üì Temperatura</option>
    </select>

    <button onclick="analizar()">Analizar equilibrio</button>

    <div class="result" id="resultado">
      <!-- Aqu√≠ aparecer√° el resultado -->
    </div>
  </div>

  <script>
    // Funci√≥n para parsear t√©rmino qu√≠mico, ej: "3H2" => {coef: 3, specie: "H2"}
    function parseTerm(term) {
      term = term.trim();
      // Buscar n√∫mero al principio, puede ser decimal o entero
      let coefMatch = term.match(/^(\d+(\.\d+)?)/);
      if (coefMatch) {
        return { coef: parseFloat(coefMatch[1]), specie: term.slice(coefMatch[1].length).trim() };
      } else {
        return { coef: 1, specie: term };
      }
    }

    // Parsear lado de la reacci√≥n (reactivos o productos), ej: "N2 + 3H2" => [{coef, specie},...]
    function parseSide(sideStr) {
      return sideStr.split('+').map(t => parseTerm(t));
    }

    // Construir expresi√≥n de K en formato texto, ej: [NH3]^2 / ([N2] * [H2]^3)
    function construirExpresionK(reactivos, productos) {
      function expresionLado(arr) {
        return arr.map(({coef, specie}) => {
          if (coef === 1) return `[${specie}]`;
          else return `[${specie}]^${coef}`;
        }).join(' ¬∑ ');
      }
      return expresionLado(productos) + " / " + "(" + expresionLado(reactivos) + ")";
    }

    // Calcular valor num√©rico de K dadas concentraciones y coeficientes
    // concs = array de n√∫meros en orden seg√∫n especie total (reactivos + productos concatenados)
    // reactivos, productos: arrays con coef y specie
    function calcularK(reactivos, productos, concs) {
      // Concatenamos reactivos y productos para el orden de concentraciones
      let especies = reactivos.concat(productos).map(e => e.specie);

      // Verificar que concs tenga el mismo length que especies
      if (concs.length !== especies.length) {
        return {error: "Cantidad de concentraciones no coincide con la cantidad de especies."};
      }

      // Crear diccionario especie -> concentraci√≥n
      let concDict = {};
      especies.forEach((sp, i) => {
        concDict[sp] = concs[i];
      });

      // Calcular producto de [productos]^coef
      let prodNumerador = 1;
      for (let p of productos) {
        let c = concDict[p.specie];
        if (c === undefined) return {error: `Concentraci√≥n de ${p.specie} no encontrada`};
        prodNumerador *= Math.pow(c, p.coef);
      }

      // Calcular producto de [reactivos]^coef
      let prodDenominador = 1;
      for (let r of reactivos) {
        let c = concDict[r.specie];
        if (c === undefined) return {error: `Concentraci√≥n de ${r.specie} no encontrada`};
        prodDenominador *= Math.pow(c, r.coef);
      }

      // Evitar divisi√≥n por cero
      if (prodDenominador === 0) return {error: "Divisi√≥n por cero: concentraci√≥n de alg√∫n reactivo es cero."};

      let K = prodNumerador / prodDenominador;
      return {K: K};
    }

    // Contar moles gaseosos para cada lado (sumar coeficientes)
    // Suponemos que todas las especies son gases (simplificaci√≥n)
    function contarMolesGas(arr) {
      let total = 0;
      for (let sp of arr) {
        total += sp.coef;
      }
      return total;
    }

    function analizar() {
      const eq = document.getElementById("equation").value.trim();
      const concStr = document.getElementById("concentrations").value.trim();
      const cambio = document.getElementById("change").value;
      const reactionType = document.getElementById("reactionType").value;
      const resultado = document.getElementById("resultado");

      let respuesta = "";

      if (!eq.includes("‚áå")) {
        resultado.innerHTML = "‚ö†Ô∏è La ecuaci√≥n no representa un equilibrio (usa ‚áå)";
        return;
      }

      // Separar reactivos y productos
      let [left, right] = eq.split("‚áå").map(s => s.trim());
      if (!left || !right) {
        resultado.innerHTML = "‚ö†Ô∏è La ecuaci√≥n no est√° completa.";
        return;
      }

      let reactivos = parseSide(left);
      let productos = parseSide(right);

      // Mostrar especies detectadas y orden para concentraciones
      let especiesTotales = reactivos.concat(productos).map(e => e.specie);
      respuesta += "‚úÖ Se detecta una reacci√≥n en equilibrio.\n";
      respuesta += "üß™ Especies detectadas (orden para concentraciones):\n";
      respuesta += especiesTotales.map((e,i) => `  ${i+1}. ${e}`).join("\n") + "\n\n";

      // Parsear concentraciones
      let concs = concStr.split(",").map(x => parseFloat(x.trim()));
      if (concs.some(c => isNaN(c))) {
        resultado.innerHTML = "‚ö†Ô∏è Las concentraciones deben ser n√∫meros separados por comas.";
        return;
      }

      if (concs.length !== especiesTotales.length) {
        resultado.innerHTML = `‚ö†Ô∏è Debe ingresar ${especiesTotales.length} concentraciones (una por especie detectada).`;
        return;
      }

      respuesta += "üìä Concentraciones iniciales:\n";
      for (let i = 0; i < especiesTotales.length; i++) {
        respuesta += `  [${especiesTotales[i]}] = ${concs[i]} mol/L\n`;
      }
      respuesta += "\n";

      // Construir expresi√≥n de K
      let expresionK = construirExpresionK(reactivos, productos);
      respuesta += `üìà Expresi√≥n de la constante de equilibrio K:\n  K = ${expresionK}\n\n`;

      // Calcular valor num√©rico de K
      let calcK = calcularK(reactivos, productos, concs);
      if (calcK.error) {
        resultado.innerHTML = "‚ö†Ô∏è Error al calcular K: " + calcK.error;
        return;
      } else {
        respuesta += `üî¢ Valor num√©rico de K con concentraciones dadas:\n  K = ${calcK.K.toFixed(4)}\n\n`;
      }

      // An√°lisis de Le Chatelier
      if (cambio) {
        respuesta += "üîÑ Predicci√≥n seg√∫n el principio de Le Chatelier:\n";

        switch (cambio) {
          case "presion":
            // Contar moles gaseosos
            let molesReactivos = contarMolesGas(reactivos);
            let molesProductos = contarMolesGas(productos);
            respuesta += "‚Ü™Ô∏è Aumento de presi√≥n: el equilibrio se desplazar√° hacia el lado con menos moles de gas.\n";
            if (molesReactivos > molesProductos) {
              respuesta += `  Moles reactivos = ${molesReactivos}, moles productos = ${molesProductos} ‚Üí se favorecen los productos.\n`;
            } else if (molesReactivos < molesProductos) {
              respuesta += `  Moles reactivos = ${molesReactivos}, moles productos = ${molesProductos} ‚Üí se favorecen los reactivos.\n`;
            } else {
              respuesta += `  Mismos moles en ambos lados (${molesReactivos}), no hay desplazamiento por presi√≥n.\n`;
            }
            break;

          case "concentracionReactivos":
            respuesta += "‚Ü™Ô∏è Aumento de reactivos: el equilibrio se desplazar√° hacia los productos.\n";
            break;

          case "concentracionProductos":
            respuesta += "‚Ü™Ô∏è Aumento de productos: el equilibrio se desplazar√° hacia los reactivos.\n";
            break;

          case "temperaturaAlta":
            if (reactionType === "endotermica") {
              respuesta += "‚Ü™Ô∏è Aumento de temperatura: la reacci√≥n endot√©rmica favorece los productos.\n";
            } else if (reactionType === "exotermica") {
              respuesta += "‚Ü™Ô∏è Aumento de temperatura: la reacci√≥n exot√©rmica favorece los reactivos.\n";
            } else {
              respuesta += "‚Ü™Ô∏è Aumento de temperatura: tipo de reacci√≥n no especificado, no se puede predecir desplazamiento.\n";
            }
            break;

          case "temperaturaBaja":
            if (reactionType === "exotermica") {
              respuesta += "‚Ü™Ô∏è Disminuci√≥n de temperatura: la reacci√≥n exot√©rmica favorece los productos.\n";
            } else if (reactionType === "endotermica") {
              respuesta += "‚Ü™Ô∏è Disminuci√≥n de temperatura: la reacci√≥n endot√©rmica favorece los reactivos.\n";
            } else {
              respuesta += "‚Ü™Ô∏è Disminuci√≥n de temperatura: tipo de reacci√≥n no especificado, no se puede predecir desplazamiento.\n";
            }
            break;
        }
      } else {
        respuesta += "‚ÑπÔ∏è No se aplic√≥ ninguna perturbaci√≥n para analizar Le Chatelier.";
      }

      resultado.innerText = respuesta;
    }
  </script>

</body>
</html>
